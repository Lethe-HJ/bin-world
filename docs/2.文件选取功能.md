# 文件选取功能

## 概述

Bin World桌面应用提供了完整的文件选取功能，允许用户在web界面中调用原生的文件对话框。这个功能通过Tauri的API实现，提供了更好的用户体验。

## 功能特性

### 🎯 支持的操作
- **单个文件选择**: 选择单个文件
- **多个文件选择**: 同时选择多个文件
- **文件夹选择**: 选择整个文件夹
- **文件保存**: 保存文件对话框

### 🔧 技术实现
- **后端**: Rust + Tauri API
- **前端**: Vue.js + TypeScript
- **通信**: Tauri invoke机制

## API接口

### 1. 单个文件选择
```typescript
const result = await FileDialog.openFile({
  title: '选择文件'
})
```

### 2. 多个文件选择
```typescript
const result = await FileDialog.openMultipleFiles({
  title: '选择多个文件'
})
```

### 3. 文件夹选择
```typescript
const result = await FileDialog.openFolder({
  title: '选择文件夹'
})
```

### 4. 文件保存
```typescript
const result = await FileDialog.saveFile({
  title: '保存文件',
  defaultName: 'untitled.txt'
})
```

## 返回数据结构

### 文件信息 (FileInfo)
```typescript
interface FileInfo {
  path: string    // 文件完整路径
  name: string    // 文件名
  size?: number   // 文件大小（字节）
}
```

### 操作结果 (FileDialogResult)
```typescript
interface FileDialogResult {
  success: boolean                    // 操作是否成功
  data?: FileInfo | FileInfo[] | string  // 返回的数据
  error?: string                      // 错误信息
}
```

## 使用示例

### 基本使用
```typescript
import { FileDialog } from '@/utils/fileDialog'

// 选择单个文件
const result = await FileDialog.openFile()
if (result.success && result.data) {
  const file = result.data as FileInfo
  console.log('选择的文件:', file.name)
  console.log('文件路径:', file.path)
  console.log('文件大小:', FileDialog.formatFileSize(file.size || 0))
}
```

### 错误处理
```typescript
const result = await FileDialog.openFile()
if (!result.success) {
  console.error('文件选择失败:', result.error)
  // 显示错误信息给用户
}
```

### 多文件处理
```typescript
const result = await FileDialog.openMultipleFiles()
if (result.success && result.data) {
  const files = result.data as FileInfo[]
  files.forEach(file => {
    console.log(`文件: ${file.name}, 大小: ${FileDialog.formatFileSize(file.size || 0)}`)
  })
}
```

## 权限配置

在 `src-tauri/tauri.conf.json` 中配置了必要的权限：

```json
{
  "capabilities": {
    "fs": {
      "scope": {
        "allow": ["**"],
        "requireLiteralLeadingDot": false,
        "directories": ["**"]
      }
    },
    "dialog": {
      "scope": ["**"]
    }
  }
}
```

## 安全考虑

1. **文件访问权限**: 用户必须主动选择文件，应用无法访问未授权的文件
2. **路径验证**: 所有文件路径都经过Tauri的安全验证
3. **沙箱环境**: 应用运行在受限的沙箱环境中

## 开发指南

### 添加新的文件操作
1. 在 `src-tauri/src/lib.rs` 中添加新的Tauri命令
2. 在 `frontend/src/utils/fileDialog.ts` 中添加对应的工具函数
3. 在 `frontend/src/types/file.ts` 中添加类型定义
4. 更新组件和文档

### 自定义文件过滤器
```typescript
const result = await FileDialog.openFile({
  title: '选择图片文件',
  filters: [
    { name: '图片文件', extensions: ['jpg', 'png', 'gif'] },
    { name: '所有文件', extensions: ['*'] }
  ]
})
```

## 故障排除

### 常见问题
1. **权限被拒绝**: 检查Tauri配置中的权限设置
2. **对话框不显示**: 确保在桌面环境中运行
3. **路径编码问题**: 使用UTF-8编码处理文件路径

### 调试技巧
1. 检查浏览器控制台的错误信息
2. 查看Tauri应用的日志输出
3. 验证文件路径的有效性

## 未来扩展

- [ ] 文件拖拽支持
- [ ] 文件预览功能
- [ ] 批量文件操作
- [ ] 文件类型检测
- [ ] 文件压缩/解压
